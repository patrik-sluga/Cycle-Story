<video id="video" autoplay playsinline muted></video>
<br>

<button onclick="startCamera()">Start Camera</button>
<button onclick="takePhoto()">Take Photo</button>
<button onclick="startRecording()">Start Video</button>
<button onclick="stopRecording()">Stop Video</button>

<br><br>

<canvas id="canvas" style="display:none;"></canvas>
<img id="photo">
<script>
let stream;
let mediaRecorder;
let recordedChunks = [];

// Start Camera
async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" }, // back camera
            audio: true
        });
        const video = document.getElementById('video');
        video.srcObject = stream;
        video.muted = true; // required for mobile autoplay
        await video.play();
    } catch(err) {
        alert("Camera access failed: " + err);
        console.error(err);
    }
}

// ðŸ“¸ Capture Photo
function takePhoto() {
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const photo = document.getElementById('photo');

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);

    photo.src = canvas.toDataURL('image/png');
}

// ðŸŽ¥ Record Video
function startRecording() {
    if(!stream) { alert("Start camera first!"); return; }

    recordedChunks = [];
    try {
        mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    } catch(e) {
        alert("Video recording not supported on this device");
        console.error(e);
        return;
    }

    mediaRecorder.ondataavailable = e => {
        if(e.data.size > 0) recordedChunks.push(e.data);
    };

    mediaRecorder.start();
}

// Stop recording and download / preview
function stopRecording() {
    if(!mediaRecorder) return;

    mediaRecorder.stop();
    mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });

        // For Android / desktop
        const url = URL.createObjectURL(blob);
        window.open(url);

        // For iOS Safari (if webm fails, you may need mp4)
        console.log("Recording complete. Size:", blob.size);
    };
}
</script>