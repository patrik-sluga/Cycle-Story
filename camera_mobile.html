<video id="video" autoplay playsinline muted style="width:100%; height:auto; background:#000;"></video>
<br>
<button id="start">Start Camera</button>
<button id="switchCam">Switch Camera</button>
<button id="photoBtn">Take Photo</button>
<canvas id="canvas" style="display:none;"></canvas>
<img id="photo" style="width:100px; margin-top:10px;">

<script>
let stream;
let usingBackCamera = true; // start with back camera by default

async function startCamera() {
  if(stream){
    // Stop all tracks if camera already running
    stream.getTracks().forEach(track => track.stop());
  }

  const constraints = {
    video: {
      facingMode: usingBackCamera ? "environment" : "user",
      width: { ideal: 1280 },
      height: { ideal: 720 }
    },
    audio: false
  };

  try {
    stream = await navigator.mediaDevices.getUserMedia(constraints);
    const video = document.getElementById('video');
    video.srcObject = stream;
    video.onloadedmetadata = () => video.play().catch(err => console.error(err));
  } catch(err) {
    alert("Camera access failed: " + err);
    console.error(err);
  }
}

// Start button
document.getElementById('start').addEventListener('click', startCamera);

// Switch camera button
document.getElementById('switchCam').addEventListener('click', () => {
  usingBackCamera = !usingBackCamera;
  startCamera();
});

// Take photo button
document.getElementById('photoBtn').addEventListener('click', () => {
  if(!stream){ alert("Start camera first!"); return; }
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const photo = document.getElementById('photo');

  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  canvas.getContext('2d').drawImage(video, 0, 0);

  photo.src = canvas.toDataURL('image/png');
});
</script>